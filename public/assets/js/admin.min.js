function LoadSelect2Script(a){$.fn.select2?a&&"function"==typeof a&&a():$.getScript("/plugins/select2/select2.min.js",a)}function LoadBootstrapValidatorScript(a){$.fn.bootstrapValidator?a&&"function"==typeof a&&a():$.getScript("/plugins/bootstrapvalidator/js/bootstrapValidator.min.js",a)}function MessagesMenuWidth(){var a=window.innerWidth,b=$("#sidebar-left").outerWidth(),c=16.666666666666664*(a-b)/100;$("#messages-menu").width(c)}function FormSelect2(){$("select").select2(),$('select[id="category_id"]').select2({placeholder:"Select Category"})}function WinMove(){$("div.box").not(".no-drop").draggable({revert:!0,zIndex:2e3,cursor:"crosshair",handle:".box-name",opacity:.8}).droppable({tolerance:"pointer",drop:function(a,b){var c=b.draggable,d=$(this);c.position(),d.position();c.swap(d),setTimeout(function(){var a=d.find("[id^=map-]"),b=c.find("[id^=map-]");b.length>0||a.length>0?(b.resize(),a.resize()):(c.resize(),d.resize())},50),setTimeout(function(){c.find("[id^=map-]").resize(),d.find("[id^=map-]").resize()},250)}})}function FormValidator(){$.fn.bootstrapValidator.DEFAULT_OPTIONS=$.extend({},$.fn.bootstrapValidator.DEFAULT_OPTIONS,{message:"The field is not valid",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}}),$("#update-config-form").bootstrapValidator({fields:{email:{validators:{notEmpty:{message:"The email address is required and can't be empty"},emailAddress:{message:"The input is not a valid email address"}}},shop_name:{message:"The shop name is not valid",validators:{notEmpty:{message:"The shop name is required and can't be empty"},stringLength:{max:255,message:"The shop name must be less than 255 characters long"}}},telephone:{validators:{notEmpty:{message:"The telephone is required and can't be empty"},digits:{message:"The value can contain only digits"},stringLength:{max:12,message:"The telephone must be less than 12 characters long"}}},address:{message:"The address is not valid",validators:{stringLength:{max:255,message:"The address must be less than 255 characters long"}}},fb_url:{message:"The FB URL is not valid",validators:{uri:{message:"The FB URL is not a valid URL"}}}}}).on("success.form.bv",function(a,b){a.preventDefault()}).on("error.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}).on("success.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}),$("#update-username-form").bootstrapValidator({fields:{username:{message:"The username is not valid",validators:{notEmpty:{message:"The username is required and can't be empty"},stringLength:{min:6,max:50,message:"The username must be more than 6 and less than 50 characters long"},regexp:{regexp:/^[a-z0-9]+$/,message:"The username can only consist of alphabetical, number"}}}}}).on("success.form.bv",function(a){a.preventDefault()}),$("#update-email-form").bootstrapValidator({fields:{email:{validators:{notEmpty:{message:"The email address is required and can't be empty"},emailAddress:{message:"The input is not a valid email address"}}}}}).on("success.form.bv",function(a){a.preventDefault()}),$("#update-user-form").bootstrapValidator({fields:{username:{message:"The username is not valid",validators:{notEmpty:{message:"The username is required and can't be empty"},stringLength:{min:6,max:50,message:"The username must be more than 6 and less than 50 characters long"},regexp:{regexp:/^[a-z0-9]+$/,message:"The username can only consist of alphabetical, number"}}},email:{validators:{notEmpty:{message:"The email address is required and can't be empty"},emailAddress:{message:"The input is not a valid email address"}}},full_name:{message:"The full name is not valid",validators:{stringLength:{max:255,message:"The full name must be less than 255 characters long"}}},birthday:{validators:{date:{format:"YYYY/MM/DD",separator:"/"}}},telephone:{validators:{digits:{message:"The value can contain only digits"},stringLength:{max:12,message:"The telephone must be less than 12 characters long"}}},address:{message:"The address is not valid",validators:{stringLength:{max:255,message:"The address must be less than 255 characters long"}}}}}).on("success.form.bv",function(a){a.preventDefault()}),$("#update-password-form").bootstrapValidator({fields:{password:{validators:{notEmpty:{message:"The password is required and can't be empty"},stringLength:{min:8,max:50,message:"The password must be more than 8 and less than 50 characters long"},regexp:{regexp:/^[a-zA-Z0-9]+$/,message:"The password can only consist of alphabetical, number"},identical:{field:"confirmPassword",message:"The password and its confirm are not the same"}}},confirm_password:{validators:{notEmpty:{message:"The confirm password is required and can't be empty"},identical:{field:"password",message:"The password and its confirm are not the same"}}}}}).on("success.form.bv",function(a){a.preventDefault()}),$("#create-category-form").bootstrapValidator({fields:{category_name:{message:"The category name is not valid",validators:{notEmpty:{message:"The category name is required and can't be empty"},stringLength:{max:255,message:"The product name must be less than 255 characters long"}}}}}).on("success.form.bv",function(a,b){a.preventDefault()}).on("error.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}).on("success.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}),$("#create-product-form").bootstrapValidator({fields:{category_ids:{message:"The category is not valid",validators:{notEmpty:{message:"The category is required and can't be empty"}}},product_name:{message:"The product name is not valid",validators:{notEmpty:{message:"The product name is required and can't be empty"},stringLength:{max:255,message:"The product name must be less than 255 characters long"}}},product_description:{message:"The product description is not valid",validators:{stringLength:{max:1024,message:"The product description must be less than 1024 characters long"}}}}}).on("success.form.bv",function(a,b){a.preventDefault()}).on("error.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}).on("success.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}),$("#update-product-form").bootstrapValidator({fields:{"category_ids[]":{message:"The category is not valid",validators:{notEmpty:{message:"The category is required and can't be empty"}}},product_name:{message:"The product name is not valid",validators:{notEmpty:{message:"The product name is required and can't be empty"},stringLength:{max:255,message:"The product name must be less than 255 characters long"}}},product_description:{message:"The product description is not valid",validators:{stringLength:{max:1024,message:"The product description must be less than 1024 characters long"}}}}}).on("success.form.bv",function(a,b){a.preventDefault()}).on("error.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}).on("success.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}),$("#feed-fb-form").bootstrapValidator({fields:{message:{message:"The message is not valid",validators:{notEmpty:{message:"The message is required and can't be empty"},stringLength:{max:1e4,message:"The message must be less than 10000 characters long"}}},link:{message:"The link is not valid",validators:{notEmpty:{message:"The link is required and can't be empty"},uri:{message:"The link is not a valid URL"}}}}}).on("success.form.bv",function(a,b){a.preventDefault()}).on("error.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)}).on("success.field.bv",function(a,b){b.bv.disableSubmitButtons(!1)})}function FormUpload(a){var b=$("#"+a.form);$("#"+a.el).fineUploader({autoUpload:!1,multiple:"undefined"==typeof a.multiple?!1:!0,template:a.template,form:{element:a.form,interceptSubmit:"undefined"==typeof a.interceptSubmit?!0:!1},classes:{success:"alert alert-success",fail:"alert alert-error"},validation:{allowedExtensions:["jpeg","jpg","gif","png"],sizeLimit:512e4},showMessage:function(c){if("undefined"!=typeof a.type&&"create-category-photo"===a.type){var d=b.find('input[name="id"]').val();if(""!==d&&"No files to upload."===c){formData=b.serialize(),url=b.attr("action");var e=$.post(url,formData);e.done(function(a){if(a.errors){var b="";$.each(a.errors,function(a,c){b+=c+"\n\r"}),show_alert_error(b)}else if(a.success){show_alert_success(a.msg),$("#add-category .box-content").fadeOut(),$("#add-category .collapse-link > i").attr("class","fa fa-chevron-down");var c=$("#category-list").find("tr#category-"+a.category.id);c.attr("data-parent-id",a.category.parent_category_id),c.attr("data-category-name",a.category.category_name),c.find("td.category_name > a > span").html(a.category.category_name_display),$('select[name="parent_category_id"]').find('option[value="'+a.category.id+'"]').text(a.category.category_name_display),$("#create-category-form").find("div.main-icon > img").attr("src",a.category.no_image),$("#create-category-form").find('input[name="id"]').val(""),resetForm($("#create-category-form"))}else show_alert_error(a.error)})}else show_alert_error(c)}else show_alert_error(c)},request:{inputName:a.inputName},callbacks:{onUpload:function(){"undefined"!=typeof a.type&&"create-product-photo"===a.type&&b.find('textarea[name="product_info"]').val(tinyMCE.activeEditor.getContent())},onSubmitted:function(){b.find(".main-icon").hide()},onCancel:function(){b.find(".main-icon").show()},onComplete:function(c,d,e,f){if("undefined"!=typeof a.type&&"create-sub-product-photo"===a.type?show_alert_success(e.msg,500):show_alert_success(e.msg),e.errors){var g="";$.each(e.errors,function(a,b){g+=b+"\n\r"}),show_alert_error(g)}else if(e.success){var h="";if("undefined"!=typeof a.type&&"update-user-icon"===a.type)$("div.avatar > img, div.main-icon > img").attr("src",e.photo_name);else if("undefined"!=typeof a.type&&"create-category-photo"===a.type){if($("#add-category .box-content").fadeOut(),$("#add-category .collapse-link > i").attr("class","fa fa-chevron-down"),show_alert_success(e.msg),"new"===e.category.type)h='<tr id="category-'+e.category.id+'" data-id="'+e.category.id+'" data-parent-id="'+e.category.parent_category_id+'" data-category-name="'+e.category.category_name+'">                                         <td class="category_name">                                             <a href="/admin/product/category/'+e.category.id+'">                                                 <img class="img-rounded" src="'+e.category.category_photo_display+'">                                                 <span>'+e.category.category_name_display+'</span>                                             </a>                                         </td>                                         <td class="text-center">                                             <div class="toggle-switch-status toggle-switch-primary-status">                                                 <label>                                                     <input type="checkbox" name="status">                                                     <div class="toggle-switch-inner-status"></div>                                                     <div class="toggle-switch-switch-status"><i class="fa fa-check"></i></div>                                                 </label>                                             </div>                                         </td>                                         <td class="text-center"><button type="button" class="btn btn-danger edit">Edit</button></td>                                     </tr>',$("#category-list").append(h),$('select[name="parent_category_id"]').append('<option value="'+e.category.id+'">'+e.category.category_name_display+"</option>");else{var i=$("#category-list").find("tr#category-"+e.category.id);i.attr("data-parent-id",e.category.parent_category_id),i.attr("data-category-name",e.category.category_name),i.find("img").attr("src",e.category.category_photo_display),i.find("td.category_name > a > span").html(e.category.category_name_display),$('select[name="parent_category_id"]').find('option[value="'+e.category.id+'"]').text(e.category.category_name_display),b.find("div.main-icon > img").attr("src",e.category.no_image),b.find('input[name="id"]').val("")}resetForm(b)}else"undefined"!=typeof a.type&&"create-product-photo"===a.type?location="/admin/product/"+e.product.id:"undefined"!=typeof a.type&&"update-product-photo"===a.type?b.find("div.main-icon > img").attr("src",e.photo_name):"undefined"!=typeof a.type&&"create-sub-product-photo"===a.type&&(h='<tr id="photo-'+e.photo_id+'" data-id="'+e.photo_id+'">                                         <td class="text-center">                                             <img class="img-rounded" src="'+e.photo_name+'">                                         </td>                                         <td class="text-center"><button type="button" class="btn btn-danger delete-btn">Delete</button></td>                                     </tr>',$("#sub-photo-list").append(h))}else show_alert_error(e.error);$("li.qq-file-id-"+c).find("a#qq-cancel-link")[0].click()}}})}function TinyMCEStart(a,b){var c=[],d="";"basic"===b&&(c=["advlist autolink lists link charmap preview anchor","searchreplace visualblocks code","insertdatetime media table contextmenu paste"],d="undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | preview"),tinymce.init({selector:a,plugins:c,toolbar:d})}function SubmitForm(a){"update-product-form"===a.attr("id")&&a.find('textarea[name="product_info"]').val(tinyMCE.activeEditor.getContent());var b=a.attr("id"),c=a.serialize(),d=a.attr("action");"undefined"==typeof d&&(d=a.attr("j_action")),a.find(".error").empty(),a.find("button").attr("disabled","disabled");var e=$.post(d,c);e.done(function(c){if(c.success){if("update-password-form"===b)resetForm(a);else if("create-group-fb-form"===b){a.find("input").val("");var d='<tr data-id="'+c.group.id+'">                                <td>'+c.group.name+'</td>                                <td class="text-center">                                    <button type="button" class="btn btn-danger delete-btn">Delete</button>                                </td>                            </tr>';$("#group-fb-list").prepend(d)}a.find("div").removeClass("has-success"),show_alert_success(c.success)}else if(c.error)"create-group-fb-form"===b&&a.find("input").val(""),show_alert_error(c.error);else if(c.errors){var e="";$.each(c.errors,function(b,c){a.find('input[name="'+b+'"]').parents("div.form-group").removeClass("has-success").addClass("has-error"),a.find('input[name="'+b+'"]').next().removeClass("glyphicon-ok").addClass("glyphicon-remove"),e+=c+"\n\r"}),show_alert_error(e)}a.find("button").removeAttr("disabled")})}function resetForm(a,b){"undefined"==typeof b&&(b=""),a.bootstrapValidator("resetForm",!0),LoadSelect2Script(a.find("select").select2("val",b))}function show_alert_success(a,b){$("#alert div.modal-content").html('<div class="alert alert-success text-center">'+a+"</div>"),$("#alert").modal("show"),"undefined"==typeof b&&(b=1e3),setTimeout(function(){$("#alert").modal("hide")},b)}function show_alert_error(a,b){$("#alert div.modal-content").html('<div class="alert alert-danger text-center">'+a+"</div>"),$("#alert").modal("show"),"undefined"==typeof b&&(b=1e3),setTimeout(function(){$("#alert").modal("hide")},b)}$(function(){var a=window.innerHeight-49;$("#main").css("min-height",a).on("click",".expand-link",function(a){var b=$("body");a.preventDefault();var c=$(this).closest("div.box"),d=$(this).find("i");d.toggleClass("fa-expand").toggleClass("fa-compress"),c.toggleClass("expanded"),b.toggleClass("body-expanded");var e=0;b.hasClass("body-expanded")&&(e=100),setTimeout(function(){c.toggleClass("expanded-padding")},e),setTimeout(function(){c.resize(),c.find("[id^=map-]").resize()},e+50)}).on("click",".collapse-link",function(a){a.preventDefault();var b=$(this).closest("div.box"),c=$(this).find("i"),d=b.find("div.box-content");d.slideToggle("fast"),c.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),setTimeout(function(){b.resize(),b.find("[id^=map-]").resize()},50)}).on("click",".close-link",function(a){a.preventDefault();var b=$(this).closest("div.box");b.remove()}),$(".show-sidebar").on("click",function(a){a.preventDefault(),$("div#main").toggleClass("sidebar-show"),setTimeout(MessagesMenuWidth,250)}),LoadBootstrapValidatorScript(FormValidator),LoadSelect2Script(FormSelect2),WinMove(),$(document).on("click","a",function(){$(this).attr("disabled",!0)}),$(document).on("click",'a[target="_blank"]',function(){$(this).attr("disabled",!1)});for(var b=["update-config-form","update-username-form","update-email-form","update-user-form","update-password-form","update-product-form","create-group-fb-form","feed-fb-form"],c=0;c<b.length;c++)$("#"+b[c]).on("submit",function(a){a.preventDefault();var b=$(this);SubmitForm(b)})}),jQuery.fn.swap=function(a){a=jQuery(a)[0];var b=this[0],c=b.parentNode.insertBefore(document.createTextNode(""),b);return a.parentNode.insertBefore(b,a),c.parentNode.insertBefore(a,c),c.parentNode.removeChild(c),this};